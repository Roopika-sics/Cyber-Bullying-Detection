{% extends "base.html" %}
{% block title %}Post List{% endblock %}
{% block content %}

<div class="max-w-2xl mx-auto mt-10 space-y-6">
    {% for post in posts %}
    <div class="bg-gray-900 text-white rounded-lg shadow-lg p-4">
        <!-- Post Header -->
        <div class="flex items-center space-x-3">
            <div class="bg-gray-700 w-10 h-10 rounded-full flex items-center justify-center text-lg font-bold">
                {{ post.user.username.0|upper }}
            </div>
            <p class="text-lg font-semibold">{{ post.user.username }}</p>
        </div>

        <!-- Post Content -->
        <p class="mt-3 text-gray-300">{{ post.content }}</p>

        <!-- Post Image -->
        {% if post.image %}
            <img src="{{ post.image.url }}" class="mt-3 rounded-lg w-full h-auto object-cover">
        {% endif %}

        <!-- Like Button & Count -->
        <div class="mt-4 flex items-center space-x-3">
            <button class="like-btn bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded text-white font-semibold"
                data-post-id="{{ post.id }}">
                {% if post.is_liked_by_user %}
                    Unlike
                {% else %}
                    Like
                {% endif %}
            </button>
            <span id="likes-count-{{ post.id }}" class="text-gray-300">{{ post.likes.count }}</span> Likes
        </div>

        <!-- Comment Form -->
        <form method="post" action="{% url 'comment_post' post.id %}" class="mt-4">
            {% csrf_token %}
            <div class="flex items-center space-x-2">
                <input type="text" name="text" placeholder="Add a comment"
                    class="w-full bg-gray-800 text-white px-3 py-2 rounded-md focus:ring-2 focus:ring-blue-500">
                <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md">
                    Comment
                </button>
            </div>
        </form>

        <!-- Comments Section -->
        {% if post.comments.all %}
        <div class="mt-4 space-y-2 border-t border-gray-700 pt-3">
            {% for comment in post.comments.all %}
            <p class="text-sm text-gray-400">
                <span class="font-semibold text-white">{{ comment.user.username }}</span>: {{ comment.text }}
            </p>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    {% endfor %}
</div>

{% endblock %}
